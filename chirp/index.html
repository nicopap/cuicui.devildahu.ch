<!DOCTYPE HTML>
<html lang="en" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>cuicui_chirp - The Cuicui Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="The user guide and reference of the cuicui framework">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../choosing_a_cuicui_crate.html"><strong aria-hidden="true">1.</strong> Choosing a cuicui crate</a></li><li class="chapter-item expanded "><a href="../usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../examples/simple_menu/index.html"><strong aria-hidden="true">2.1.</strong> Using the dsl macro</a></li><li class="chapter-item expanded "><a href="../../examples/chirp_menu/index.html"><strong aria-hidden="true">2.2.</strong> Using a chirp file</a></li><li class="chapter-item expanded "><a href="../../examples/custom_dsl/index.html"><strong aria-hidden="true">2.3.</strong> Defining your own DSL</a></li><li class="chapter-item expanded "><a href="../reactivity.html"><strong aria-hidden="true">2.4.</strong> Reactivity</a></li></ol></li><li class="chapter-item expanded "><a href="../../examples/index.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../examples/chirpunk/index.html"><strong aria-hidden="true">3.1.</strong> chirpunk</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="../../dsl/index.html"><strong aria-hidden="true">4.</strong> cuicui_dsl</a></li><li class="chapter-item expanded "><a href="../../chirp/index.html" class="active"><strong aria-hidden="true">5.</strong> cuicui_chirp</a></li><li class="chapter-item expanded "><a href="../../layout/index.html"><strong aria-hidden="true">6.</strong> cuicui_layout</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../layout/debug.html"><strong aria-hidden="true">6.1.</strong> Layout debug overlay</a></li><li class="chapter-item expanded "><a href="../../layout/content_sized.html"><strong aria-hidden="true">6.2.</strong> Content-sized leaf nodes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Cuicui Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cuicui_chirp"><a class="header" href="#cuicui_chirp"><code>cuicui_chirp</code></a></h1>
<p><a href="https://cuicui.nicopap.ch/introduction.html"><img src="https://img.shields.io/badge/The_Cuicui_Book-blue" alt="The Book" /></a>
<a href="https://docs.rs/cuicui_chirp/"><img src="https://docs.rs/cuicui_chirp/badge.svg" alt="Documentation" /></a></p>
<p><code>cuicui_chirp</code> defines a file format for text-based bevy scene description.</p>
<p>It is used in <code>cuicui</code> for UI, but can describe any kind of scene.</p>
<p>It includes:</p>
<ul>
<li>A parser for the file format.</li>
<li>A bevy loader to load those files in bevy, with <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/loader/struct.Plugin.html"><code>loader::Plugin</code></a>.</li>
<li>A trait (<a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl/trait.ParseDsl.html"><code>ParseDsl</code></a>) to use your own type’s methods as chirp methods</li>
<li>A macro to automatically implement this trait (<a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/index.html"><code>parse_dsl_impl</code></a>)</li>
</ul>
<p>The syntax is very close to that of <a href="https://lib.rs/crates/cuicui_dsl"><code>cuicui_dsl</code></a>’s <code>dsl!</code> macro,
with <a href="#import-statements">some additions</a>.</p>
<h2 id="when-to-use-cuicui_chirp"><a class="header" href="#when-to-use-cuicui_chirp">When to use <code>cuicui_chirp</code>?</a></h2>
<ul>
<li>You want a powerful and extensible scene definition format for bevy
to replace the innane <code>cmds.spawn(…).insert(…).with_children(…)</code> dance.</li>
<li>You want quick iteration time using hot reloading and useful error messages.</li>
<li>You want to minimize the amount of rust code you write to manage scenes.</li>
<li>You want a re-usable scene definition format.</li>
</ul>
<p>Be aware that <code>cuicui_chirp</code>, by its nature, is not a small dependency.
Consider using <a href="https://lib.rs/crates/cuicui_dsl"><code>cuicui_dsl</code></a> if dependency size matters to you.</p>
<p>Also, as of <code>0.10</code>, <code>cuicui_chirp</code> doesn’t support WASM for image and font assets.</p>
<h2 id="how-to-use-cuicui_chirp"><a class="header" href="#how-to-use-cuicui_chirp">How to use <code>cuicui_chirp</code>?</a></h2>
<h3 id="cargo-features"><a class="header" href="#cargo-features">Cargo features</a></h3>
<ul>
<li><strong><code>fancy_errors</code></strong> (default): Print parsing error messages in a nicely formatted way.</li>
<li><strong><code>macros</code></strong> (default): Define and export the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/index.html"><code>parse_dsl_impl</code></a> macro</li>
<li><strong><code>load_font</code></strong> (default): load <code>Handle&lt;Font&gt;</code> as method argument</li>
<li><strong><code>load_image</code></strong> (default): load <code>Handle&lt;Image&gt;</code> as method argument</li>
<li><strong><code>more_unsafe</code></strong>: Convert some runtime checks into unsafe assumptions.
In theory, this is sound, but <code>cuicui_chirp</code> is not tested enough to my taste
for making those assumptions by default.</li>
</ul>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<p><code>cuicui_chirp</code> reads files ending with the <code>.chirp</code> extension. To load a <code>.chirp</code>
file, use <code>ChirpBundle</code> as follow:</p>
<pre><code class="language-rust noplayground"><span class="boring">#[cfg(feature = &quot;doc_and_test&quot;)] mod test {
</span><span class="boring">use cuicui_chirp::__doc_helpers::*; // ignore this line pls
</span>use bevy::prelude::*;
use cuicui_chirp::ChirpBundle;

fn setup(mut cmds: Commands, assets: Res&lt;AssetServer&gt;) {
    cmds.spawn((Camera2dBundle::default(), LayoutRootCamera));
    cmds.spawn(ChirpBundle::from(assets.load(&quot;my_scene.chirp&quot;)));
}
<span class="boring">}</span></code></pre>
<p>You need however to add the loader pluging (<a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/loader/struct.Plugin.html"><code>loader::Plugin</code></a>) for this to work.
The plugin is parametrized over the DSL type.
The DSL type needs to implement the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl/trait.ParseDsl.html"><code>ParseDsl</code></a> trait.</p>
<p>Here is an example using <code>cuicui_layout_bevy_ui</code>’s DSL:</p>
<pre><code class="language-rust no_run noplayground"><span class="boring">#[cfg(feature = &quot;doc_and_test&quot;)] mod test {
</span><span class="boring">use cuicui_chirp::__doc_helpers::*; // ignore this line pls
</span><span class="boring">fn setup() {}
</span>use bevy::prelude::*;
use cuicui_layout_bevy_ui::UiDsl;

fn main() {
    App::new()
      .add_plugins((
        DefaultPlugins,
        cuicui_chirp::loader::Plugin::new::&lt;UiDsl&gt;(),
      ))
      .add_systems(Startup, setup)
      .run();
}
<span class="boring">}</span></code></pre>
<h3 id="dsl-specific-documentation"><a class="header" href="#dsl-specific-documentation">DSL-specific documentation</a></h3>
<p>The identifiers within parenthesis are methods on the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl/trait.ParseDsl.html"><code>ParseDsl</code></a>.</p>
<p>Since the <code>chirp</code> format is a wrapper over a <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl/trait.ParseDsl.html"><code>ParseDsl</code></a>, refer to the methods
on the <code>ParseDsl</code> impl you added as <code>loader::Plugin</code>.</p>
<h3 id="making-a-dslbundle-compatible-with-cuicui_chirp"><a class="header" href="#making-a-dslbundle-compatible-with-cuicui_chirp">Making a <code>DslBundle</code> compatible with <code>cuicui_chirp</code></a></h3>
<p>Let’s re-use the example in <a href="https://lib.rs/crates/cuicui_dsl"><code>cuicui_dsl</code></a> and extend it to work with <code>cuicui_chirp</code>.</p>
<p>We had a <code>MyDsl</code> that implements <code>DslBundle</code>, now we need to also implement <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl/trait.ParseDsl.html"><code>ParseDsl</code></a>
for it. So that methods are accessible in <code>ParseDsl</code>, use the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/index.html"><code>parse_dsl_impl</code></a>
attribute macro, and add it to the <code>impl</code> block where all the DSL’s methods are
defined:</p>
<pre><code class="language-diff">     font_size: f32,
 }
+#[cuicui_chirp::parse_dsl_impl]
 impl MyDsl {
     pub fn style(&amp;mut self, style: Style) {
         self.style = style;
</code></pre>
<p>Yep, for the simple case that’s it. Just avoid panicking inside methods if you
want to take advantage of hot reloading.</p>
<h3 id="chirp-file-format"><a class="header" href="#chirp-file-format"><code>.chirp</code> file format</a></h3>
<p>The basic syntax is similar to the <a href="https://lib.rs/crates/cuicui_dsl"><code>cuicui_dsl</code></a> <code>dsl!</code> macro.</p>
<p>One major difference is that <code>code</code> blocks are replaced with a function registry.
You can register a function using the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/loader/struct.WorldHandles.html"><code>WorldHandles</code></a> resource. Registered
functions are global to all chirp files loaded using <code>cuicui_chirp</code>.</p>
<p>The other differences are the addition of import statements (<code>use</code>),
template definitions (<code>fn</code>), and template calls (<code>template!()</code>).</p>
<h4 id="import-statements"><a class="header" href="#import-statements">Import statements</a></h4>
<p>They are currently not implemented, so please proceed to the next section.</p>
<details><summary><b>Draft design</b></summary>
<blockquote>
<p><strong>Note</strong>
Imports ARE NOT IMPLEMENTED</p>
</blockquote>
<p>In <code>cuicui_chirp</code> you are not limited to a single file. You can <em>import</em> other
chirp files.</p>
<p>To do so, use an import statement. Import statements <strong>are the first statements
in the file</strong>; They start with the <code>use</code> keyword, are followed by the source
path of the file to import and an optional “<code>as</code> imported_name”, this is the
name with which the import will be refered in this file.</p>
<pre><code class="language-ron">use different/file
// ...
</code></pre>
<p>You have two ways to use imports:</p>
<ol>
<li>As <strong>whole file imports</strong>. You can import any file and directly use it as
if it was a template without parameters. This is useful if you want to compose
several complex menus you write in different files.</li>
<li>As <strong>template collections</strong>. You can import individual templates defined in
a file. Just complete the path with a <code>.template_name</code>.</li>
</ol>
<p>Similarly to rust, you can combine imports, but only templates from the same file,
so the following is valid:</p>
<pre><code class="language-ron">use different/file.template
use different/file.{template1, template2}
// ...
</code></pre>
<p>Wild card imports are not supported.</p>
<h4 id="publicity"><a class="header" href="#publicity">Publicity</a></h4>
<p>However, to be able to import templates, you need to mark them as <code>pub</code> in the
source template. Just prefix the <code>fn</code> with <code>pub</code> and that’s it.</p>
</details>
<h4 id="template-definitions"><a class="header" href="#template-definitions">Template definitions</a></h4>
<p>chirp files admit a series of <code>fn</code> definitions at the very beginning of the
file. A <code>fn</code> definition looks very similar to rust function definitions.
It has a name and zero or several parameters. Their body is a single statement:</p>
<pre><code class="language-rust ignore noplayground">// file: &lt;scene.chirp&gt;
// template name
//   ↓
// vvvvvv
fn spacer() {
	Spacer(height(10px) width(10%) bg(coral))
}
//             parameter
// template name  ↓
//    ↓           ↓
// vvvvvv vvvvvvvvvvv
fn button(button_text) {
    Entity(named(button_text) width(95%) height(200px) bg(purple) row) {
        ButtonText(text(button_text) rules(0.5*, 0.5*))
    }
}</code></pre>
<p>You can call a template like you would call a rust macro, by writing the template
name followed by <code>!</code> and parenthesis:</p>
<pre><code class="language-rust ignore noplayground"><span class="boring">fn sys(cmds: &amp;mut cuicui_dsl::EntityCommands) { cuicui_dsl::dsl!(cmds,
</span>// file: &lt;scene.chirp&gt; (following)
Menu(screen_root row bg(darkgrey)) {
    TestSpacer(width(30%) height(100px) bg(pink))
    spacer!()
    button!(&quot;Hello world&quot;)
}
<span class="boring">)}</span></code></pre>
<p>When a template is called, it will be replaced by the single root statement
defined as body of the <code>fn</code> definition for that template.</p>
<h4 id="template-extras"><a class="header" href="#template-extras">Template Extras</a></h4>
<p>Template calls can be followed by <strong>template extras</strong>.</p>
<pre><code class="language-rust ignore noplayground"><span class="boring">fn sys(cmds: &amp;mut cuicui_dsl::EntityCommands) { cuicui_dsl::dsl!(cmds,
</span>// file: &lt;scene.chirp&gt; (following)
Menu(screen_root row bg(darkgrey)) {
    TestSpacer(width(30%) height(100px) bg(pink))

    // Additional method list after the template arguments list
    //       vvvvvvvvvvvvvvvvvvvvvv
    spacer!()(width(50%) bg(coral))

    // Both additional methods and additional children added after the argument list
    //                    vvvvvvvvvv
    button!(&quot;Hello world&quot;)(column) {
        MoreChildren(text(&quot;Hello&quot;))
        MoreChildren(text(&quot;World&quot;))
    }
}
<span class="boring">)}</span></code></pre>
<p>The additional methods will be added at the end of template’s root statement
method list. While the additional children statements will be added as children
of the template’s root statement.</p>
<p>Take for example this chirp file:</p>
<pre><code class="language-rust ignore noplayground">fn deep_trailing2(line, color) {
    Trailing2Parent {
        Trailing2 (text(line) bg(color) width(1*))
    }
}
fn deep_trailing1(line2, line1) {
    deep_trailing2!(line1, red) {
        Trailing1 (text(line2) bg(green) width(2*))
    }
}
deep_trailing1!(&quot;Second line&quot;, &quot;First line&quot;) (column bg(beige) rules(1.1*, 2*) margin(20)) {
    Trailing0 (text(&quot;Third line&quot;) bg(blue))
}</code></pre>
<p>It is equivalent to:</p>
<pre><code class="language-rust ignore noplayground"><span class="boring">fn sys(cmds: &amp;mut cuicui_dsl::EntityCommands) { cuicui_dsl::dsl!(cmds,
</span>Trailing2Parent(column bg(beige) rules(1.1*, 2*) margin(20)) {
    Trailing2 (text(&quot;First line&quot;) bg(red) width(1*))
    Trailing1 (text(&quot;Second line&quot;) bg(green) width(2*))
    Trailing0 (text(&quot;Third line&quot;) bg(blue))
}
<span class="boring">)}</span></code></pre>
<h4 id="parameter-substitution"><a class="header" href="#parameter-substitution">Parameter substitution</a></h4>
<blockquote>
<p><strong>Note</strong>
“argument” here may refer to two things: (1) the value passed as
argument to a template, in <code>template!(foo_bar)</code>, <code>foo_bar</code> is an argument.
(2) arguments passed to <em>methods</em>, in <code>Entity(text(method_argument))</code>,
<code>method_argument</code> is a method argument.</p>
<p>The name declared between parenthesis in the <code>fn</code> name is a <strong>parameter</strong>. In
<code>fn button(button_text)</code>, <code>button_text</code> is a template parameter.</p>
</blockquote>
<p>When a template is called, the body of the <code>fn</code> is inserted where the call
is made, arguments passed to the template are inlined within the statement
of the template body.</p>
<p>Please pay close attention to how parameters are inlined:</p>
<ul>
<li>Parameters are only inlined <strong>in method arguments</strong></li>
<li>Parameters are <strong>not inlined within quotes</strong></li>
<li>Parameters are only inlined <strong>if they are the whole argument</strong></li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><strong>❗ Compatibility Notice ❗</strong></th></tr></thead><tbody>
<tr><td>In the future, parameters will be allowed in more contexts: <ul><li>in method lists (such as <code>Entity(parameter)</code>)</li><li>As template names (such as <code>parameter!()</code>)</li><li>Embedded in a more complex method argument (such as <code>Entity(mehod({ width: parameter }))</code>)</li></ul></td></tr>
<tr><td>To avoid painfull breaking changes, avoid naming parameters the same as DSL methods or templates.</td></tr>
</tbody></table>
</div>
<pre><code class="language-rust ignore noplayground"><span class="boring">fn sys(cmds: &amp;mut EntityCommands) { dsl!(cmds,
</span>fn button(button_text) {
    // Will spawn an entity without name, with tooltip set to whatever
    // was passed to `button!`.
    Entity(tooltip(button_text) width(95%) height(200px) bg(purple) row) {
        // Will spawn an entity named &quot;button_text&quot; with text &quot;button_text&quot;
        button_text(text(&quot;button_text&quot;) rules(0.5*, 0.5*))

        // Current limitation:
        // `gizmo` method will be called with `GizmoBuilder(button_text)` as first
        // argument and whatever was passed to `button!` as second argument
        Gizmo(gizmo(GizmoBuilder(button_text), button_text) rules(0.5*, 0.5*))
    }
}
<span class="boring">)}</span></code></pre>
<h3 id="tips-and-tricks"><a class="header" href="#tips-and-tricks">Tips and tricks</a></h3>
<p>See the <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/index.html">dedicated documentation page</a> for all available
configuration options on <code>parse_dsl_impl</code>.</p>
<h4 id="performance"><a class="header" href="#performance">Performance</a></h4>
<p>Consider explicitly depending on the <code>log</code> and <code>tracing</code> crates, and enable the
<code>&quot;release_max_level_debug&quot;</code> features of those crates, so that log messages are
elided from release builds.</p>
<p><code>cuicui_chirp</code> contains <strong>a lot</strong> of trace logging in very hot loops.
<code>&quot;release_max_level_debug&quot;</code> will remove trace logging <strong>at compile time</strong> and
not only make the code faster (code that would otherwise read a lock atomic),
but it enables <strong>more optimization</strong>, inlining and loop unrolling.</p>
<p>First, find the version of the <code>log</code> and <code>tracing</code> crates in your dependency tree with:</p>
<pre><code class="language-sh">cargo tree -p log -p tracing
</code></pre>
<p>Then, add them to your <code>Cargo.toml</code> and enable a <code>max_level</code> feature. Note
that they are already in your dependency tree, so there is no downside to doing so:</p>
<pre><code class="language-toml">log = { version = &quot;&lt;version found with `cargo tree`&gt;&quot;, features = [&quot;release_max_level_debug&quot;] }
tracing = { version = &quot;&lt;version found with `cargo tree`&gt;&quot;, features = [&quot;release_max_level_debug&quot;] }
# Note: I recommend `release_max_level_warn` instead.
# `debug` is specific for performance regarding `cuicui_chirp`
</code></pre>
<p>Next time you compile your game, you’ll probably have to recompile the whole
dependency tree, since <code>tracing</code> and <code>log</code> are usually fairly deep.</p>
<h4 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h4>
<p>Remember the inheritance trick from <a href="https://lib.rs/crates/cuicui_dsl#inheritance"><code>cuicui_dsl</code></a>? <code>parse_dsl_impl</code> is
compatible with it. Use the <code>delegate</code> argument to specify the field to which
to delegate methods not found on the <code>MyDsl</code> impl.</p>
<pre><code class="language-rust ignore">// pub struct MyDsl&lt;D = ()&gt; {
//     #[deref]
//     inner: D,
// }
#[parse_dsl_impl(delegate = inner)]
impl&lt;D: DslBundle&gt; MyDsl&lt;D&gt; {
    // ...
}</code></pre>
<p>See <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/fn.delegate.html"><code>parse_dsl_impl::delegate</code></a>.</p>
<h4 id="reflectdsl"><a class="header" href="#reflectdsl"><code>ReflectDsl</code></a></h4>
<p>Unlike <code>cuicui_dsl</code>, it is possible to use <a href="https://docs.rs/bevy/0.11/bevy/reflect/trait.Reflect.html"><code>Reflect</code></a> to define DSLs. See the
<a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/reflect/struct.ReflectDsl.html"><code>ReflectDsl</code></a> docs for details.</p>
<h4 id="custom-parsers"><a class="header" href="#custom-parsers">Custom parsers</a></h4>
<p>Since <code>.chirp</code> files are in text format, we need to convert text into method
arguments. <code>parse_dsl_impl</code> parses differently method arguments depending on
their type.</p>
<p>See <a href="https://docs.rs/cuicui_chirp/0.10.1/cuicui_chirp/parse_dsl_impl/fn.type_parsers.html"><code>parse_dsl_impl::type_parsers</code></a> for details.</p>
<h2 id="what-is-the-relationship-between-cuicui_dsl-and-cuicui_chirp"><a class="header" href="#what-is-the-relationship-between-cuicui_dsl-and-cuicui_chirp">What is the relationship between <code>cuicui_dsl</code> and <code>cuicui_chirp</code>?</a></h2>
<p><code>cuicui_dsl</code> is a macro (<code>dsl!</code>), while <code>cuicui_chirp</code> is a scene file format,
parser and bevy loader. <code>cuicui_chirp</code> builds on top of <code>cuicui_dsl</code>, and has
different features than <code>cuicui_dsl</code>. Here is a feature matrix:</p>
<div class="table-wrapper"><table><thead><tr><th>features</th><th><code>cuicui_dsl</code></th><th><code>cuicui_chirp</code></th></tr></thead><tbody>
<tr><td>statements &amp; methods</td><td>✅</td><td>✅</td></tr>
<tr><td><code>code</code> blocks with in-line rust code</td><td>✅</td><td></td></tr>
<tr><td><code>code</code> calling registered functions</td><td></td><td>✅</td></tr>
<tr><td><code>fn</code> templates</td><td>rust</td><td>✅</td></tr>
<tr><td>import from other files</td><td>rust</td><td></td></tr>
<tr><td>hot-reloading</td><td></td><td>✅</td></tr>
<tr><td>reflection-based methods</td><td></td><td>✅</td></tr>
<tr><td>special syntax for colors, rules</td><td></td><td>✅</td></tr>
<tr><td>lightweight</td><td>✅</td><td></td></tr>
<tr><td>Allows for non-<code>Reflect</code> components</td><td>✅</td><td></td></tr>
</tbody></table>
</div>
<p>You may use <code>cuicui_dsl</code> in combination with <code>cuicui_chirp</code>, both crates fill
different niches.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../dsl/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../layout/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../dsl/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../layout/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
